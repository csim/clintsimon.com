<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>
        Custom Field control implemented as a User Control - csim
    </title>
    <!-- generated 2013-10-30T18:59:28+01:00 -->

    <link rel="icon" href="/favicon.ico">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="http://lh3.googleusercontent.com/-Ea8xoWWt_P8/ToKxKe5jkjI/AAAAAAAAC24/4pXdtIm0k7E/techhike_favicon.png" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Clint Simon">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="google-site-verification" content="9122UHrLTdTksyNCp_xG5dypMZu2evQmgwu43GVHjOo" />

    <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700|Ubuntu+Condensed|Orbitron:400" rel="stylesheet" type="text/css" />

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/base.css" rel="stylesheet">
</head>

<body>

    <div id="masthead">
        <div id="masthead-inner">
            <a class="title" href="/">csim</a>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="span9 content">
              <a name="/2008/03/13/Custom-Field-control-implemented-as-a-User-Control"></a>
<h1><a href="/2008/03/13/Custom-Field-control-implemented-as-a-User-Control">Custom Field control implemented as a User Control</a></h1>
<div class="post-date">13 March 2008</div>

<p>When creating custom controls it is often must easier to create a control using the &quot;User Control&quot; development model instead of the &quot;Server Control&quot; model. <a href="http://msdn.microsoft.com/en-us/library/zt27tfhy.aspx">Server controls</a> generally have a more &quot;low level&quot; feel and dictate that the developer build the control&#39;s rendering from scratch. Either by building a control tree or by constructing the rendered output in code.</p>

<p>Alternatively <a href="http://msdn.microsoft.com/en-us/library/y6wb1a0e.aspx">user controls</a> have nice separation of code and presentation by virtue of having a markup file (.ascx) and a code behind file; much like a standard aspx page. User controls can be created and developed using the same standard approaches and processes that we all know and love from the aspx page model.</p>

<p>When implementing a custom field control for SharePoint, the development experience can be streamlined to a large degree by utilizing a user control. Traditionally field controls are created using the server control model but with a few tricks you can implement a custom field control with a user control.</p>

<p>First, here is the base class used for the field control. It has a virtual property used to set the user control path. A property override for the value of the field which is read from the user control. On initialization it loads the user control and sets the context.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="lineno"> 2</span> <span class="k">using</span> <span class="nn">System.Web.UI</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="k">using</span> <span class="nn">Microsoft.SharePoint.WebControls</span><span class="p">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="k">namespace</span> <span class="nn">MyProject.Web.UI.FieldControls</span>
<span class="lineno"> 6</span> <span class="p">{</span>
<span class="lineno"> 7</span>     <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">UserControlFieldBase</span> <span class="p">:</span> <span class="n">BaseFieldControl</span>
<span class="lineno"> 8</span>     <span class="p">{</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span>         <span class="k">private</span> <span class="n">SPFieldUserControlBase</span> <span class="n">_usercontrol</span><span class="p">;</span>
<span class="lineno">11</span> 
<span class="lineno">12</span>         <span class="k">public</span> <span class="k">virtual</span> <span class="kt">string</span> <span class="n">UserControlPath</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">13</span> 
<span class="lineno">14</span>         <span class="k">public</span> <span class="k">override</span> <span class="kt">object</span> <span class="n">Value</span>
<span class="lineno">15</span>         <span class="p">{</span>
<span class="lineno">16</span>             <span class="k">get</span>
<span class="lineno">17</span>             <span class="p">{</span>
<span class="lineno">18</span>                 <span class="k">return</span> <span class="n">_usercontrol</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="k">base</span><span class="p">.</span><span class="n">Value</span> <span class="p">:</span> <span class="n">_usercontrol</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="lineno">19</span>             <span class="p">}</span>
<span class="lineno">20</span>             <span class="k">set</span>
<span class="lineno">21</span>             <span class="p">{</span>
<span class="lineno">22</span>                 <span class="k">base</span><span class="p">.</span><span class="n">ItemFieldValue</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
<span class="lineno">23</span>             <span class="p">}</span>
<span class="lineno">24</span>         <span class="p">}</span>
<span class="lineno">25</span> 
<span class="lineno">26</span>         <span class="k">public</span> <span class="nf">UserControlFieldBase</span><span class="p">()</span> <span class="p">:</span> <span class="k">base</span><span class="p">()</span>
<span class="lineno">27</span>         <span class="p">{</span>
<span class="lineno">28</span>         <span class="p">}</span>
<span class="lineno">29</span> 
<span class="lineno">30</span>         <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="lineno">31</span>         <span class="p">{</span>
<span class="lineno">32</span>             <span class="k">base</span><span class="p">.</span><span class="n">OnInit</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="lineno">33</span>             <span class="n">UserControlPath</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="lineno">34</span>         <span class="p">}</span>
<span class="lineno">35</span> 
<span class="lineno">36</span>         <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">CreateChildControls</span><span class="p">()</span>
<span class="lineno">37</span>         <span class="p">{</span>
<span class="lineno">38</span>             <span class="n">Controls</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="lineno">39</span>             <span class="k">base</span><span class="p">.</span><span class="n">CreateChildControls</span><span class="p">();</span>
<span class="lineno">40</span> 
<span class="lineno">41</span>             <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">UserControlPath</span><span class="p">))</span>
<span class="lineno">42</span>             <span class="p">{</span>
<span class="lineno">43</span>             <span class="n">_usercontrol</span> <span class="p">=</span> <span class="p">(</span><span class="n">SPFieldUserControlBase</span><span class="p">)</span><span class="n">Page</span><span class="p">.</span><span class="n">LoadControl</span><span class="p">(</span><span class="n">UserControlPath</span><span class="p">);</span>
<span class="lineno">44</span>             <span class="n">_usercontrol</span><span class="p">.</span><span class="n">FieldControl</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
<span class="lineno">45</span> 
<span class="lineno">46</span>             <span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">_usercontrol</span><span class="p">);</span>
<span class="lineno">47</span>         <span class="p">}</span>
<span class="lineno">48</span>     <span class="p">}</span>
<span class="lineno">49</span> <span class="p">}</span>
</code></pre></div>

<p>Here&#39;s an example field control subclass. This class simply specifies the user control path and let&#39;s the base class handle all the details of loading the user control and setting the context. This is the server control that you will embed into you page layouts.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">using</span> <span class="nn">System.Web.UI</span><span class="p">;</span>
<span class="lineno"> 2</span> <span class="k">namespace</span> <span class="nn">MyProject.Web.UI.FieldControls</span>
<span class="lineno"> 3</span> <span class="p">{</span>
<span class="lineno"> 4</span>     <span class="k">public</span> <span class="k">class</span> <span class="nc">MyFieldContol</span> <span class="p">:</span> <span class="n">UserControlFieldBase</span>
<span class="lineno"> 5</span>     <span class="p">{</span>
<span class="lineno"> 6</span>         <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="n">UserControlPath</span>
<span class="lineno"> 7</span>         <span class="p">{</span>
<span class="lineno"> 8</span>             <span class="k">get</span>
<span class="lineno"> 9</span>             <span class="p">{</span>
<span class="lineno">10</span>             <span class="k">return</span> <span class="s">&quot;~/_controltemplates/MyFieldControl.ascx&quot;</span><span class="p">;</span>
<span class="lineno">11</span>             <span class="p">}</span>
<span class="lineno">12</span>         <span class="p">}</span>
<span class="lineno">13</span>     <span class="p">}</span>
<span class="lineno">14</span> <span class="p">}</span>
</code></pre></div>

<p>Next, is the abstract base class for the user control. This class provides a property for a reference to the parent field control and an abstract property for the field value. The field control property is important because our user control will need to know all the information about the field it is attached to. This includes the SPField context and control mode among other things.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">using</span> <span class="nn">System.Web.UI</span><span class="p">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">namespace</span> <span class="nn">MyProject.Web.UI.FieldControls</span>
<span class="lineno"> 4</span> <span class="p">{</span>
<span class="lineno"> 5</span>     <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">SPFieldUserControlBase</span> <span class="p">:</span> <span class="n">UserControl</span>
<span class="lineno"> 6</span>     <span class="p">{</span>
<span class="lineno"> 7</span>         <span class="k">protected</span> <span class="nf">SPFieldUserControlBase</span><span class="p">();</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>         <span class="k">public</span> <span class="n">BaseFieldControl</span> <span class="n">FieldControl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">10</span>         <span class="k">public</span> <span class="k">abstract</span> <span class="kt">object</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">11</span>     <span class="p">}</span>
<span class="lineno">12</span> <span class="p">}</span>
</code></pre></div>

<p>Lastly you can create a user control that inherits from the SPFieldUserControlBase class and implement the specific UI that is necessary for you field control to function. See my pervious post on how to create a custom field control for further direction on creating field controls from scratch.
This technique also you to have easiest possible development process while leveraging the SharePoint field control infrastructure. Any questions or comments, please let me know!</p>

	
<div class="post-separator"></div>


          </div>

          <div class="span3 sidebar">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                    <li><a href="/about/">About</a></li>
                    <li><a href="/archive/">Archive</a></li>
                    <li><a href="/topics/">Topics</a></li>
                </ul>
                <div class="social-icons">
                    <a href="http://www.facebook.com/techhike">
                        <img src="/images/facebook.png" style="width: 30px;" alt="Facebook" /></a>
                        <a href="http://www.twitter.com/clintsim">
                            <img src="/images/twitter.png" style="width: 30px;" alt="Twitter" /></a>
                            <br />
                            <a href="http://www.linkedin.com/profile/view?id=2238939&amp;trk=tab_pro">
                                <img src="/images/linkedin.png" style="width: 30px;" alt="Linkedin" /></a>
                                <a href="http://github.com/csim">
                                    <img src="/images/github.png" style="width: 30px;" alt="GitHub" /></a>
                                    <br />
                                    <a href="/feed.xml"><img src="/images/rss.gif" style="width: 29px; height: 31px;" alt="Feed" /></a>
                                </div>
                    <!--<a class="twitter-timeline" href="https://twitter.com/TechHike" data-widget-id="250295447481098241">Tweets by @@TechHike</a>
                    <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + "://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs); } }(document, "script", "twitter-wjs");</script>-->

                </div>
            </div>

        </div>

    </div>


    <script src="//code.jquery.com/jquery-1.6.2.min.js"></script>
    <script src="/base.js"></script>

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-25860409-1']);
        _gaq.push(['_setDomainName', 'techhike.net']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</body>
</html>
